require('dotenv').config();
const mongoose = require('mongoose');
const Admin = require('../models/Admin');
const Business = require('../models/Business');
const User = require('../models/User');
const Category = require('../models/Category');
const Collection = require('../models/Collection');
const ProductTL = require('../models/ProductTL');
const ProductPoint = require('../models/ProductPoint');
const CollectionSet = require('../models/CollectionSet');
const Shipment = require('../models/Shipment');
const OrderTL = require('../models/OrderTL');
const Loyalty = require('../models/Loyalty');
const Log = require('../models/Log');
const UserCollection = require('../models/UserCollection');

const seedDatabase = async () => {
  try {
    console.log('üå± Starting database seed...');

    // Connect to MongoDB
    await mongoose.connect(process.env.MONGODB_URI);
    console.log('‚úÖ Connected to MongoDB');

    // Clear existing data
    await Promise.all([
      Admin.deleteMany({}),
      Business.deleteMany({}),
      User.deleteMany({}),
      Category.deleteMany({}),
      Collection.deleteMany({}),
      ProductTL.deleteMany({}),
      ProductPoint.deleteMany({}),
      CollectionSet.deleteMany({}),
      Shipment.deleteMany({}),
      OrderTL.deleteMany({}),
      Loyalty.deleteMany({}),
      Log.deleteMany({}),
      UserCollection.deleteMany({})
    ]);
    console.log('üóëÔ∏è  Cleared existing data');

    // Create Admin
    const admin = await Admin.create({
      name: 'Admin User',
      email: 'admin@system.com',
      password: 'admin123'
    });
    console.log('üë§ Admin created:', admin.email);

    // Create Businesses (Mersin locations)
    const business1 = await Business.create({
      name: 'Kahve D√ºkkanƒ±',
      email: 'info@kahvedukkani.com',
      password: 'business123',
      description: 'El yapƒ±mƒ± kahve ve seramik koleksiyonlarƒ±',
      address: 'Yeni≈üehir, Mersin',
      phone: '+905551234567',
      logoUrl: 'https://api.dicebear.com/7.x/initials/svg?seed=KD',
      coverImageUrl: 'https://images.unsplash.com/photo-1511920170033-f8396924c348?w=800',
      themeColor: '#8B4513',
      location: {
        type: 'Point',
        coordinates: [34.615545, 36.793144], // [longitude, latitude] - Mersin
        address: 'Yeni≈üehir, Mersin',
        city: 'Mersin',
        district: 'Yeni≈üehir'
      },
      rating: 4.7,
      totalReviews: 248,
      subscriptionStatus: 'active',
      subscriptionEndsAt: new Date('2026-03-01')
    });

    const business2 = await Business.create({
      name: 'Seramik At√∂lyesi',
      email: 'info@seramikat√∂lyesi.com',
      password: 'business123',
      description: 'El yapƒ±mƒ± seramik √ºr√ºnler',
      address: 'Mezitli, Mersin',
      phone: '+905559876543',
      logoUrl: 'https://api.dicebear.com/7.x/initials/svg?seed=SA',
      coverImageUrl: 'https://images.unsplash.com/photo-1493106641515-6b5631de4bb9?w=800',
      themeColor: '#D2691E',
      location: {
        type: 'Point',
        coordinates: [34.614682, 36.794202], // [longitude, latitude] - Mersin
        address: 'Mezitli, Mersin',
        city: 'Mersin',
        district: 'Mezitli'
      },
      rating: 4.9,
      totalReviews: 87,
      subscriptionStatus: 'active',
      subscriptionEndsAt: new Date('2026-04-01')
    });

    const business3 = await Business.create({
      name: 'Lezzet Duraƒüƒ±',
      email: 'info@lezzetduragi.com',
      password: 'business123',
      description: 'Taze kahve ve lezzetli atƒ±≈ütƒ±rmalƒ±klar',
      address: 'Toroslar, Mersin',
      phone: '+905551112233',
      logoUrl: 'https://api.dicebear.com/7.x/initials/svg?seed=LD',
      coverImageUrl: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=800',
      themeColor: '#FF6B35',
      location: {
        type: 'Point',
        coordinates: [34.619654, 36.796874], // [longitude, latitude] - Mersin
        address: 'Toroslar, Mersin',
        city: 'Mersin',
        district: 'Toroslar'
      },
      rating: 4.5,
      totalReviews: 156,
      subscriptionStatus: 'active',
      subscriptionEndsAt: new Date('2026-05-01')
    });
    console.log('üè™ Businesses created');

    // Create Users
    const user1 = await User.create({
      name: 'Ay≈üe Yƒ±lmaz',
      email: 'ayse@gmail.com',
      provider: 'google',
      providerId: 'google-123',
      avatarUrl: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Ayse',
      loyaltyPoints: 1200 // Test i√ßin ba≈ülangƒ±√ß puanƒ±
    });

    const user2 = await User.create({
      name: 'Mehmet Kaya',
      email: 'mehmet@privaterelay.appleid.com',
      provider: 'apple',
      providerId: 'apple-456',
      loyaltyPoints: 500
    });
    console.log('üë• Users created');

    // Create Categories for Business 1
    const cat1 = await Category.create({
      name: 'Sƒ±cak ƒ∞√ßecekler',
      iconUrl: 'https://api.dicebear.com/7.x/icons/svg?seed=hot',
      imageUrl: 'https://images.unsplash.com/photo-1511920170033-f8396924c348?w=400',
      businessId: business1._id
    });

    const cat2 = await Category.create({
      name: 'Tatlƒ±lar',
      iconUrl: 'https://api.dicebear.com/7.x/icons/svg?seed=dessert',
      imageUrl: 'https://images.unsplash.com/photo-1488477181946-6428a0291777?w=400',
      businessId: business1._id
    });

    const cat3 = await Category.create({
      name: 'Soƒüuk ƒ∞√ßecekler',
      iconUrl: 'https://api.dicebear.com/7.x/icons/svg?seed=cold',
      imageUrl: 'https://images.unsplash.com/photo-1546173159-315724a31696?w=400',
      businessId: business1._id
    });

    const cat4 = await Category.create({
      name: 'Atƒ±≈ütƒ±rmalƒ±klar',
      iconUrl: 'https://api.dicebear.com/7.x/icons/svg?seed=snack',
      imageUrl: 'https://images.unsplash.com/photo-1599490659213-e2b9527bd087?w=400',
      businessId: business1._id
    });

    const cat5 = await Category.create({
      name: 'Kahvaltƒ±',
      iconUrl: 'https://api.dicebear.com/7.x/icons/svg?seed=breakfast',
      imageUrl: 'https://images.unsplash.com/photo-1533089860892-a7c6f0a88666?w=400',
      businessId: business1._id
    });

    const cat6 = await Category.create({
      name: '√ñzel Kahveler',
      iconUrl: 'https://api.dicebear.com/7.x/icons/svg?seed=special',
      imageUrl: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=400',
      businessId: business1._id
    });
    console.log('üìÅ Categories created');

    // Create Global Collections (Admin creates these)
    const collection1 = await Collection.create({
      name: 'Seramik Koleksiyonu',
      description: 'El yapƒ±mƒ± seramik √ºr√ºnler',
      imageUrl: 'https://images.unsplash.com/photo-1578749556568-bc2c40e68b61?w=400',
      isGlobal: true
    });

    const collection2 = await Collection.create({
      name: 'Ah≈üap Koleksiyonu',
      description: 'Doƒüal ah≈üap √ºr√ºnler',
      imageUrl: 'https://images.unsplash.com/photo-1533090161767-e6ffed986c88?w=400',
      isGlobal: true
    });

    const collection3 = await Collection.create({
      name: 'Cam Koleksiyonu',
      description: 'El i≈ü√ßiliƒüi cam √ºr√ºnler',
      imageUrl: 'https://images.unsplash.com/photo-1525974160448-038dacadcc71?w=400',
      isGlobal: true
    });
    console.log('üé® Global Collections created');

    // Create TL Products - LOTS OF THEM WITH OPTIONS!
    const tlProducts = [];

    // Ortak se√ßenekler
    const commonOptions = [
      {
        name: '≈ûeker',
        choices: [
          { name: '≈ûekersiz', priceModifier: 0 },
          { name: 'Az ≈ûekerli', priceModifier: 0 },
          { name: 'Orta ≈ûekerli', priceModifier: 0 },
          { name: '√áok ≈ûekerli', priceModifier: 0 }
        ]
      },
      {
        name: 'S√ºt',
        choices: [
          { name: 'S√ºts√ºz', priceModifier: 0 },
          { name: 'Normal S√ºt', priceModifier: 0 },
          { name: 'Yaƒüsƒ±z S√ºt', priceModifier: 2 },
          { name: 'Badem S√ºt√º', priceModifier: 5 },
          { name: 'Soya S√ºt√º', priceModifier: 5 },
          { name: 'Yulaf S√ºt√º', priceModifier: 5 }
        ]
      },
      {
        name: 'Boyut',
        choices: [
          { name: 'K√º√ß√ºk', priceModifier: 0 },
          { name: 'Orta', priceModifier: 10 },
          { name: 'B√ºy√ºk', priceModifier: 20 }
        ]
      },
      {
        name: 'Ekstra',
        choices: [
          { name: 'Ekstra Shot (+1)', priceModifier: 15 },
          { name: 'Karamel Sos', priceModifier: 8 },
          { name: '√áikolata Sos', priceModifier: 8 },
          { name: 'Vanilya Aromasƒ±', priceModifier: 5 },
          { name: 'Fƒ±ndƒ±k Aromasƒ±', priceModifier: 5 }
        ]
      }
    ];

    // SICAK ƒ∞√áECEKLER (11 √ºr√ºn)
    tlProducts.push(
      {
        name: 'Espresso',
        description: 'Yoƒüun ve aromatik tek shot espresso',
        categoryId: cat1._id,
        categoryName: cat1.name,
        priceTL: 50,
        earnedPoints: 50,
        stock: 30,
        imageUrl: 'https://images.unsplash.com/photo-1510591509098-f4fdc6d0ff04?w=400',
        businessId: business1._id,
        options: [
          commonOptions[0], // ≈ûeker
          commonOptions[2], // Boyut
          commonOptions[3]  // Ekstra
        ]
      },
      {
        name: 'Double Espresso',
        description: '√áift shot espresso, g√º√ßl√º ve yoƒüun',
        categoryId: cat1._id,
        categoryName: cat1.name,
        priceTL: 70,
        earnedPoints: 70,
        stock: 30,
        imageUrl: 'https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?w=400',
        businessId: business1._id,
        options: [
          commonOptions[0], // ≈ûeker
          commonOptions[2], // Boyut
          commonOptions[3]  // Ekstra
        ]
      },
      {
        name: 'Latte',
        description: 'Espresso ve s√ºtl√º k√∂p√ºk ile hazƒ±rlanan klasik latte',
        categoryId: cat1._id,
        categoryName: cat1.name,
        priceTL: 80,
        earnedPoints: 80,
        stock: 25,
        imageUrl: 'https://images.unsplash.com/photo-1561882468-9110e03e0f78?w=400',
        businessId: business1._id
      },
      {
        name: 'Cappuccino',
        description: 'Espresso, s√ºt ve yoƒüun s√ºt k√∂p√ºƒü√º',
        categoryId: cat1._id,
        categoryName: cat1.name,
        priceTL: 85,
        earnedPoints: 85,
        stock: 25,
        imageUrl: 'https://images.unsplash.com/photo-1572442388796-11668a67e53d?w=400',
        businessId: business1._id
      },
      {
        name: 'Americano',
        description: 'Yoƒüun espresso ve sƒ±cak su ile hazƒ±rlanan klasik americano',
        categoryId: cat1._id,
        categoryName: cat1.name,
        priceTL: 70,
        earnedPoints: 70,
        stock: 30,
        imageUrl: 'https://images.unsplash.com/photo-1551030173-122aabc4489c?w=400',
        businessId: business1._id
      },
      {
        name: 'Flat White',
        description: 'Mikro k√∂p√ºkl√º s√ºt ve espresso',
        categoryId: cat1._id,
        categoryName: cat1.name,
        priceTL: 90,
        earnedPoints: 90,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1570968915860-54d5c301fa9f?w=400',
        businessId: business1._id
      },
      {
        name: 'Mocha',
        description: 'Espresso, s√ºt ve √ßikolata sosu',
        categoryId: cat1._id,
        categoryName: cat1.name,
        priceTL: 95,
        earnedPoints: 95,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1607260550778-aa9d29444ce1?w=400',
        businessId: business1._id
      },
      {
        name: 'T√ºrk Kahvesi',
        description: 'Geleneksel T√ºrk kahvesi',
        categoryId: cat1._id,
        categoryName: cat1.name,
        priceTL: 60,
        earnedPoints: 60,
        stock: 25,
        imageUrl: 'https://images.unsplash.com/photo-1610889556528-9a770e32642f?w=400',
        businessId: business1._id
      },
      {
        name: 'Sƒ±cak √áikolata',
        description: 'Ger√ßek √ßikolata ile hazƒ±rlanan sƒ±cak i√ßecek',
        categoryId: cat1._id,
        categoryName: cat1.name,
        priceTL: 75,
        earnedPoints: 75,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1542990253-0d0f5be5f0ed?w=400',
        businessId: business1._id
      },
      {
        name: 'Chai Latte',
        description: 'Baharatlƒ± √ßay ve s√ºt karƒ±≈üƒ±mƒ±',
        categoryId: cat1._id,
        categoryName: cat1.name,
        priceTL: 85,
        earnedPoints: 85,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1578899952107-9d9d7a6b5d3f?w=400',
        businessId: business1._id
      },
      {
        name: 'Filtre Kahve',
        description: '√ñzel √ßekirdeklerle hazƒ±rlanan filtre kahve',
        categoryId: cat1._id,
        categoryName: cat1.name,
        priceTL: 65,
        earnedPoints: 65,
        stock: 25,
        imageUrl: 'https://images.unsplash.com/photo-1497935586351-b67a49e012bf?w=400',
        businessId: business1._id
      }
    );

    // SOƒûUK ƒ∞√áECEKLER (10 √ºr√ºn)
    tlProducts.push(
      {
        name: 'Ice Latte',
        description: 'Buzlu latte, serinletici ve lezzetli',
        categoryId: cat3._id,
        categoryName: cat3.name,
        priceTL: 85,
        earnedPoints: 85,
        stock: 25,
        imageUrl: 'https://images.unsplash.com/photo-1517487881594-2787fef5ebf7?w=400',
        businessId: business1._id
      },
      {
        name: 'Ice Americano',
        description: 'Buzlu americano',
        categoryId: cat3._id,
        categoryName: cat3.name,
        priceTL: 75,
        earnedPoints: 75,
        stock: 25,
        imageUrl: 'https://images.unsplash.com/photo-1461023058943-07fcbe16d735?w=400',
        businessId: business1._id
      },
      {
        name: 'Cold Brew',
        description: 'Soƒüuk demleme kahve, yumu≈üak ve aromatik',
        categoryId: cat3._id,
        categoryName: cat3.name,
        priceTL: 90,
        earnedPoints: 90,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1517487881594-2787fef5ebf7?w=400',
        businessId: business1._id
      },
      {
        name: 'Frappuccino',
        description: 'Buzlu kahve ve krema karƒ±≈üƒ±mƒ±',
        categoryId: cat3._id,
        categoryName: cat3.name,
        priceTL: 100,
        earnedPoints: 100,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1572490122747-3968b75cc699?w=400',
        businessId: business1._id
      },
      {
        name: 'Ice Mocha',
        description: 'Buzlu mocha, √ßikolatalƒ± ve serinletici',
        categoryId: cat3._id,
        categoryName: cat3.name,
        priceTL: 100,
        earnedPoints: 100,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1578374173705-0a5c2c6e8d8f?w=400',
        businessId: business1._id
      },
      {
        name: 'Limonata',
        description: 'Taze sƒ±kƒ±lmƒ±≈ü limonata',
        categoryId: cat3._id,
        categoryName: cat3.name,
        priceTL: 60,
        earnedPoints: 60,
        stock: 30,
        imageUrl: 'https://images.unsplash.com/photo-1523677011781-c91d1bbe2f9d?w=400',
        businessId: business1._id
      },
      {
        name: 'Smoothie (√áilek)',
        description: 'Taze √ßilek smoothie',
        categoryId: cat3._id,
        categoryName: cat3.name,
        priceTL: 85,
        earnedPoints: 85,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1505252585461-04db1eb84625?w=400',
        businessId: business1._id
      },
      {
        name: 'Smoothie (Mango)',
        description: 'Tropikal mango smoothie',
        categoryId: cat3._id,
        categoryName: cat3.name,
        priceTL: 85,
        earnedPoints: 85,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1600271886742-f049cd451bba?w=400',
        businessId: business1._id
      },
      {
        name: 'Milkshake (√áikolata)',
        description: 'Yoƒüun √ßikolatalƒ± milkshake',
        categoryId: cat3._id,
        categoryName: cat3.name,
        priceTL: 90,
        earnedPoints: 90,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1572490122747-3968b75cc699?w=400',
        businessId: business1._id
      },
      {
        name: 'Milkshake (Vanilya)',
        description: 'Klasik vanilya milkshake',
        categoryId: cat3._id,
        categoryName: cat3.name,
        priceTL: 90,
        earnedPoints: 90,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1579954115545-a95591f28bfc?w=400',
        businessId: business1._id
      }
    );

    // TATLILAR (10 √ºr√ºn)
    tlProducts.push(
      {
        name: 'Cheesecake',
        description: 'Ev yapƒ±mƒ± klasik cheesecake',
        categoryId: cat2._id,
        categoryName: cat2.name,
        priceTL: 95,
        earnedPoints: 95,
        stock: 12,
        imageUrl: 'https://images.unsplash.com/photo-1533134486753-c833f0ed4866?w=400',
        businessId: business1._id
      },
      {
        name: 'Brownie',
        description: '√áikolatalƒ± brownie, ƒ±slak kek',
        categoryId: cat2._id,
        categoryName: cat2.name,
        priceTL: 75,
        earnedPoints: 75,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1606313564200-e75d5e30476c?w=400',
        businessId: business1._id
      },
      {
        name: 'Tiramisu',
        description: 'ƒ∞talyan klasiƒüi tiramisu',
        categoryId: cat2._id,
        categoryName: cat2.name,
        priceTL: 100,
        earnedPoints: 100,
        stock: 10,
        imageUrl: 'https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?w=400',
        businessId: business1._id
      },
      {
        name: 'Sufle',
        description: 'Sƒ±cak √ßikolatalƒ± sufle',
        categoryId: cat2._id,
        categoryName: cat2.name,
        priceTL: 110,
        earnedPoints: 110,
        stock: 8,
        imageUrl: 'https://images.unsplash.com/photo-1624353365286-3f8d62daad51?w=400',
        businessId: business1._id
      },
      {
        name: 'San Sebastian',
        description: 'Yanƒ±k cheesecake',
        categoryId: cat2._id,
        categoryName: cat2.name,
        priceTL: 105,
        earnedPoints: 105,
        stock: 10,
        imageUrl: 'https://images.unsplash.com/photo-1621303837174-89787a7d4729?w=400',
        businessId: business1._id
      },
      {
        name: 'Magnolia',
        description: 'Muzlu magnolia tatlƒ±sƒ±',
        categoryId: cat2._id,
        categoryName: cat2.name,
        priceTL: 85,
        earnedPoints: 85,
        stock: 12,
        imageUrl: 'https://images.unsplash.com/photo-1563805042-7684c019e1cb?w=400',
        businessId: business1._id
      },
      {
        name: 'Profiterol',
        description: '√áikolata soslu profiterol',
        categoryId: cat2._id,
        categoryName: cat2.name,
        priceTL: 90,
        earnedPoints: 90,
        stock: 10,
        imageUrl: 'https://images.unsplash.com/photo-1612201142855-9d0e7b9e5e7e?w=400',
        businessId: business1._id
      },
      {
        name: 'Ekler',
        description: 'Kremalƒ± ekler pasta',
        categoryId: cat2._id,
        categoryName: cat2.name,
        priceTL: 70,
        earnedPoints: 70,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1587241321921-91a834d82e01?w=400',
        businessId: business1._id
      },
      {
        name: 'Frambuazlƒ± Tart',
        description: 'Taze frambuazlƒ± tart',
        categoryId: cat2._id,
        categoryName: cat2.name,
        priceTL: 95,
        earnedPoints: 95,
        stock: 8,
        imageUrl: 'https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400',
        businessId: business1._id
      },
      {
        name: '√áilekli Pasta',
        description: 'Taze √ßilekli dilim pasta',
        categoryId: cat2._id,
        categoryName: cat2.name,
        priceTL: 85,
        earnedPoints: 85,
        stock: 12,
        imageUrl: 'https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400',
        businessId: business1._id
      }
    );

    // ATI≈ûTIRMALIKLAR (10 √ºr√ºn)
    tlProducts.push(
      {
        name: 'Croissant',
        description: 'Tereyaƒülƒ± croissant',
        categoryId: cat4._id,
        categoryName: cat4.name,
        priceTL: 45,
        earnedPoints: 45,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1555507036-ab1f4038808a?w=400',
        businessId: business1._id
      },
      {
        name: '√áikolatalƒ± Croissant',
        description: '√áikolata dolgulu croissant',
        categoryId: cat4._id,
        categoryName: cat4.name,
        priceTL: 55,
        earnedPoints: 55,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1623334044303-241021148842?w=400',
        businessId: business1._id
      },
      {
        name: 'Kurabiye',
        description: 'Ev yapƒ±mƒ± kurabiye √ße≈üitleri',
        categoryId: cat4._id,
        categoryName: cat4.name,
        priceTL: 35,
        earnedPoints: 35,
        stock: 30,
        imageUrl: 'https://images.unsplash.com/photo-1558961363-fa8fdf82db35?w=400',
        businessId: business1._id
      },
      {
        name: 'Muffin (√áikolatalƒ±)',
        description: '√áikolata par√ßalƒ± muffin',
        categoryId: cat4._id,
        categoryName: cat4.name,
        priceTL: 50,
        earnedPoints: 50,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1607958996333-41aef7caefaa?w=400',
        businessId: business1._id
      },
      {
        name: 'Muffin (Yaban Mersinli)',
        description: 'Yaban mersini dolgulu muffin',
        categoryId: cat4._id,
        categoryName: cat4.name,
        priceTL: 50,
        earnedPoints: 50,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1607920591413-4ec007e70023?w=400',
        businessId: business1._id
      },
      {
        name: 'Sandvi√ß (Ton Balƒ±klƒ±)',
        description: 'Ton balƒ±klƒ± sandvi√ß',
        categoryId: cat4._id,
        categoryName: cat4.name,
        priceTL: 70,
        earnedPoints: 70,
        stock: 12,
        imageUrl: 'https://images.unsplash.com/photo-1528735602780-2552fd46c7af?w=400',
        businessId: business1._id
      },
      {
        name: 'Sandvi√ß (Tavuklu)',
        description: 'Izgara tavuklu sandvi√ß',
        categoryId: cat4._id,
        categoryName: cat4.name,
        priceTL: 75,
        earnedPoints: 75,
        stock: 12,
        imageUrl: 'https://images.unsplash.com/photo-1509722747041-616f39b57569?w=400',
        businessId: business1._id
      },
      {
        name: 'Tost',
        description: 'Klasik karƒ±≈üƒ±k tost',
        categoryId: cat4._id,
        categoryName: cat4.name,
        priceTL: 55,
        earnedPoints: 55,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1528736235302-52922df5c122?w=400',
        businessId: business1._id
      },
      {
        name: 'Waffle',
        description: '√áikolata soslu waffle',
        categoryId: cat4._id,
        categoryName: cat4.name,
        priceTL: 80,
        earnedPoints: 80,
        stock: 10,
        imageUrl: 'https://images.unsplash.com/photo-1562376552-0d160a2f238d?w=400',
        businessId: business1._id
      },
      {
        name: 'Pankek',
        description: 'Ak√ßaaƒüa√ß ≈üuruplu pankek',
        categoryId: cat4._id,
        categoryName: cat4.name,
        priceTL: 75,
        earnedPoints: 75,
        stock: 10,
        imageUrl: 'https://images.unsplash.com/photo-1567620905732-2d1ec7ab7445?w=400',
        businessId: business1._id
      }
    );

    // KAHVALTI (10 √ºr√ºn)
    tlProducts.push(
      {
        name: 'Serpme Kahvaltƒ±',
        description: 'Zengin serpme kahvaltƒ± tabaƒüƒ±',
        categoryId: cat5._id,
        categoryName: cat5.name,
        priceTL: 150,
        earnedPoints: 150,
        stock: 10,
        imageUrl: 'https://images.unsplash.com/photo-1533089860892-a7c6f0a88666?w=400',
        businessId: business1._id
      },
      {
        name: 'Menemen',
        description: 'Geleneksel menemen',
        categoryId: cat5._id,
        categoryName: cat5.name,
        priceTL: 65,
        earnedPoints: 65,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1525351484163-7529414344d8?w=400',
        businessId: business1._id
      },
      {
        name: 'Omlet',
        description: 'Peynirli omlet',
        categoryId: cat5._id,
        categoryName: cat5.name,
        priceTL: 60,
        earnedPoints: 60,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1612929633738-8fe44f7ec841?w=400',
        businessId: business1._id
      },
      {
        name: 'Sahanda Yumurta',
        description: 'Klasik sahanda yumurta',
        categoryId: cat5._id,
        categoryName: cat5.name,
        priceTL: 50,
        earnedPoints: 50,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1525351484163-7529414344d8?w=400',
        businessId: business1._id
      },
      {
        name: 'Sucuklu Yumurta',
        description: 'Sucuklu sahanda yumurta',
        categoryId: cat5._id,
        categoryName: cat5.name,
        priceTL: 70,
        earnedPoints: 70,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1608039829572-78524f79c4c7?w=400',
        businessId: business1._id
      },
      {
        name: 'G√∂zleme (Peynirli)',
        description: 'El a√ßmasƒ± peynirli g√∂zleme',
        categoryId: cat5._id,
        categoryName: cat5.name,
        priceTL: 55,
        earnedPoints: 55,
        stock: 12,
        imageUrl: 'https://images.unsplash.com/photo-1601050690597-df0568f70950?w=400',
        businessId: business1._id
      },
      {
        name: 'G√∂zleme (Kƒ±ymalƒ±)',
        description: 'El a√ßmasƒ± kƒ±ymalƒ± g√∂zleme',
        categoryId: cat5._id,
        categoryName: cat5.name,
        priceTL: 65,
        earnedPoints: 65,
        stock: 12,
        imageUrl: 'https://images.unsplash.com/photo-1601050690597-df0568f70950?w=400',
        businessId: business1._id
      },
      {
        name: 'B√∂rek (Su B√∂reƒüi)',
        description: 'Ev yapƒ±mƒ± su b√∂reƒüi',
        categoryId: cat5._id,
        categoryName: cat5.name,
        priceTL: 60,
        earnedPoints: 60,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1621939514649-280e2ee25f60?w=400',
        businessId: business1._id
      },
      {
        name: 'Poƒüa√ßa',
        description: 'Peynirli poƒüa√ßa',
        categoryId: cat5._id,
        categoryName: cat5.name,
        priceTL: 40,
        earnedPoints: 40,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1509440159596-0249088772ff?w=400',
        businessId: business1._id
      },
      {
        name: 'Simit',
        description: 'Taze simit',
        categoryId: cat5._id,
        categoryName: cat5.name,
        priceTL: 25,
        earnedPoints: 25,
        stock: 30,
        imageUrl: 'https://images.unsplash.com/photo-1586444248902-2f64eddc13df?w=400',
        businessId: business1._id
      }
    );

    // √ñZEL KAHVELER (10 √ºr√ºn)
    tlProducts.push(
      {
        name: 'V60 Pour Over',
        description: '√ñzel √ßekirdekle V60 demleme',
        categoryId: cat6._id,
        categoryName: cat6.name,
        priceTL: 95,
        earnedPoints: 95,
        stock: 10,
        imageUrl: 'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=400',
        businessId: business1._id
      },
      {
        name: 'Chemex',
        description: 'Chemex ile √∂zel demleme',
        categoryId: cat6._id,
        categoryName: cat6.name,
        priceTL: 100,
        earnedPoints: 100,
        stock: 8,
        imageUrl: 'https://images.unsplash.com/photo-1511920170033-f8396924c348?w=400',
        businessId: business1._id
      },
      {
        name: 'Aeropress',
        description: 'Aeropress ile √∂zel kahve',
        categoryId: cat6._id,
        categoryName: cat6.name,
        priceTL: 90,
        earnedPoints: 90,
        stock: 10,
        imageUrl: 'https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?w=400',
        businessId: business1._id
      },
      {
        name: 'French Press',
        description: 'French press ile √∂zel demleme',
        categoryId: cat6._id,
        categoryName: cat6.name,
        priceTL: 85,
        earnedPoints: 85,
        stock: 12,
        imageUrl: 'https://images.unsplash.com/photo-1517487881594-2787fef5ebf7?w=400',
        businessId: business1._id
      },
      {
        name: 'Siphon Coffee',
        description: 'Siphon y√∂ntemiyle √∂zel kahve',
        categoryId: cat6._id,
        categoryName: cat6.name,
        priceTL: 120,
        earnedPoints: 120,
        stock: 5,
        imageUrl: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=400',
        businessId: business1._id
      },
      {
        name: 'Affogato',
        description: 'Vanilyalƒ± dondurma √ºzerine espresso',
        categoryId: cat6._id,
        categoryName: cat6.name,
        priceTL: 85,
        earnedPoints: 85,
        stock: 12,
        imageUrl: 'https://images.unsplash.com/photo-1563729784474-d77dbb933a9e?w=400',
        businessId: business1._id
      },
      {
        name: 'Cortado',
        description: 'Espresso ve az miktarda s√ºt',
        categoryId: cat6._id,
        categoryName: cat6.name,
        priceTL: 75,
        earnedPoints: 75,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1517487881594-2787fef5ebf7?w=400',
        businessId: business1._id
      },
      {
        name: 'Macchiato',
        description: 'Espresso √ºzerine s√ºt k√∂p√ºƒü√º',
        categoryId: cat6._id,
        categoryName: cat6.name,
        priceTL: 70,
        earnedPoints: 70,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1517487881594-2787fef5ebf7?w=400',
        businessId: business1._id
      },
      {
        name: 'Ristretto',
        description: 'Kƒ±sa √ßekilmi≈ü yoƒüun espresso',
        categoryId: cat6._id,
        categoryName: cat6.name,
        priceTL: 60,
        earnedPoints: 60,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1514432324607-a09d9b4aefdd?w=400',
        businessId: business1._id
      },
      {
        name: 'Lungo',
        description: 'Uzun √ßekilmi≈ü espresso',
        categoryId: cat6._id,
        categoryName: cat6.name,
        priceTL: 65,
        earnedPoints: 65,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=400',
        businessId: business1._id
      }
    );

    await ProductTL.insertMany(tlProducts);
    console.log(`‚òï ${tlProducts.length} TL Products created`);

    // Create Point Products
    await ProductPoint.create([
      // Seramik Koleksiyonu
      {
        name: 'El Yapƒ±mƒ± Seramik Kupa',
        description: '√ñzel tasarƒ±m seramik kupa',
        collectionId: collection1._id,
        collectionName: collection1.name,
        pricePoint: 500,
        stock: 25,
        imageUrl: 'https://images.unsplash.com/photo-1514228742587-6b1558fcca3d?w=400',
        businessId: business1._id
      },
      {
        name: 'Seramik Tabak',
        description: 'El yapƒ±mƒ± dekoratif tabak',
        collectionId: collection1._id,
        collectionName: collection1.name,
        pricePoint: 800,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1610701596007-11502861dcfa?w=400',
        businessId: business1._id
      },
      {
        name: 'Seramik Kase Seti',
        description: '3 adet farklƒ± boyutta seramik kase',
        collectionId: collection1._id,
        collectionName: collection1.name,
        pricePoint: 1200,
        stock: 10,
        imageUrl: 'https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=400',
        businessId: business1._id
      },
      {
        name: 'Seramik √áaydanlƒ±k',
        description: 'El yapƒ±mƒ± seramik √ßaydanlƒ±k',
        collectionId: collection1._id,
        collectionName: collection1.name,
        pricePoint: 1500,
        stock: 8,
        imageUrl: 'https://images.unsplash.com/photo-1563822249366-3efbb5c8c7e7?w=400',
        businessId: business1._id
      },
      // Ah≈üap Koleksiyonu
      {
        name: 'Ah≈üap Ka≈üƒ±k Seti',
        description: 'El yapƒ±mƒ± ah≈üap ka≈üƒ±k seti (3 adet)',
        collectionId: collection2._id,
        collectionName: collection2.name,
        pricePoint: 600,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1533090161767-e6ffed986c88?w=400',
        businessId: business1._id
      },
      {
        name: 'Ah≈üap Kesme Tahtasƒ±',
        description: 'Doƒüal ah≈üap kesme tahtasƒ±',
        collectionId: collection2._id,
        collectionName: collection2.name,
        pricePoint: 1200,
        stock: 12,
        imageUrl: 'https://images.unsplash.com/photo-1565183928294-7d22f2d8c29b?w=400',
        businessId: business1._id
      },
      {
        name: 'Ah≈üap Servis Tepsisi',
        description: 'El i≈ü√ßiliƒüi ah≈üap servis tepsisi',
        collectionId: collection2._id,
        collectionName: collection2.name,
        pricePoint: 900,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1595435742656-5272d0b3fa82?w=400',
        businessId: business1._id
      },
      {
        name: 'Ah≈üap Baharat Deƒüirmeni',
        description: 'El yapƒ±mƒ± ah≈üap baharat deƒüirmeni',
        collectionId: collection2._id,
        collectionName: collection2.name,
        pricePoint: 700,
        stock: 18,
        imageUrl: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=400',
        businessId: business1._id
      },
      // Cam Koleksiyonu
      {
        name: 'El √úflemesi Cam Vazo',
        description: '√ñzel tasarƒ±m cam vazo',
        collectionId: collection3._id,
        collectionName: collection3.name,
        pricePoint: 1500,
        stock: 10,
        imageUrl: 'https://images.unsplash.com/photo-1525974160448-038dacadcc71?w=400',
        businessId: business1._id
      },
      {
        name: 'Cam Bardak Seti',
        description: 'El yapƒ±mƒ± cam bardak seti (6 adet)',
        collectionId: collection3._id,
        collectionName: collection3.name,
        pricePoint: 800,
        stock: 20,
        imageUrl: 'https://images.unsplash.com/photo-1572635148818-ef6fd45eb394?w=400',
        businessId: business1._id
      },
      {
        name: 'Cam S√ºrahi',
        description: 'Dekoratif cam s√ºrahi',
        collectionId: collection3._id,
        collectionName: collection3.name,
        pricePoint: 1000,
        stock: 15,
        imageUrl: 'https://images.unsplash.com/photo-1584627904094-beb5c4e15f8e?w=400',
        businessId: business1._id
      },
      {
        name: 'Cam Kavanoz Seti',
        description: 'Dekoratif cam kavanoz seti (4 adet)',
        collectionId: collection3._id,
        collectionName: collection3.name,
        pricePoint: 650,
        stock: 25,
        imageUrl: 'https://images.unsplash.com/photo-1603569283847-aa295f0d016a?w=400',
        businessId: business1._id
      }
    ]);
    console.log('üéÅ Point Products created');

    // Get created products for CollectionSet
    const seramikProducts = await ProductPoint.find({ collectionId: collection1._id });
    const ahsapProducts = await ProductPoint.find({ collectionId: collection2._id });

    // Create Collection Sets
    const collectionSet1 = await CollectionSet.create({
      name: 'Seramik Koleksiyonu - Set A',
      description: 'Temel seramik √ºr√ºn seti',
      category: 'Seramik',
      imageUrl: 'https://images.unsplash.com/photo-1578749556568-bc2c40e68b61?w=400',
      products: seramikProducts.slice(0, 2).map(p => ({
        productId: p._id.toString(),
        productName: p.name,
        quantity: 10,
        pricePoint: p.pricePoint,
        imageUrl: p.imageUrl
      })),
      totalItems: 20
    });

    const collectionSet2 = await CollectionSet.create({
      name: 'Ah≈üap Koleksiyonu - Set B',
      description: 'Premium ah≈üap √ºr√ºn seti',
      category: 'Ah≈üap',
      imageUrl: 'https://images.unsplash.com/photo-1533090161767-e6ffed986c88?w=400',
      products: ahsapProducts.slice(0, 3).map(p => ({
        productId: p._id.toString(),
        productName: p.name,
        quantity: 8,
        pricePoint: p.pricePoint,
        imageUrl: p.imageUrl
      })),
      totalItems: 24
    });
    console.log('üì¶ Collection Sets created');

    // Create Shipments
    await Shipment.create({
      type: 'admin',
      collectionSetId: collectionSet1._id,
      collectionSetName: collectionSet1.name,
      businessId: business1._id,
      businessName: business1.name,
      businessAddress: business1.address,
      businessPhone: business1.phone,
      status: 'delivered',
      trackingNumber: 'TRK123456789',
      shippingCompany: 'Aras Kargo',
      totalItems: 20,
      products: collectionSet1.products.map(p => ({
        productId: null,
        name: p.productName,
        quantity: p.quantity,
        pricePoint: p.pricePoint
      })),
      shippedAt: new Date('2026-02-01T09:00:00Z'),
      deliveredAt: new Date('2026-02-03T14:30:00Z')
    });

    await Shipment.create({
      type: 'admin',
      collectionSetId: collectionSet2._id,
      collectionSetName: collectionSet2.name,
      businessId: business1._id,
      businessName: business1.name,
      businessAddress: business1.address,
      businessPhone: business1.phone,
      status: 'in_transit',
      trackingNumber: 'TRK987654321',
      shippingCompany: 'Yurti√ßi Kargo',
      totalItems: 25,
      products: collectionSet2.products.map(p => ({
        productId: null,
        name: p.productName,
        quantity: p.quantity,
        pricePoint: p.pricePoint
      })),
      shippedAt: new Date('2026-02-07T10:00:00Z'),
      estimatedDeliveryAt: new Date('2026-02-10T18:00:00Z')
    });
    console.log('üöö Shipments created');

    // Create Loyalty
    await Loyalty.create({
      userId: user1._id,
      businessId: business1._id,
      points: 1200
    });
    console.log('‚≠ê Loyalty points created');

    // Create Sample Order
    const products = await ProductTL.find({ businessId: business1._id }).limit(2);
    await OrderTL.create({
      businessId: business1._id,
      userId: user1._id,
      items: [
        {
          productId: products[0]._id,
          productName: products[0].name,
          quantity: 2,
          unitPrice: products[0].priceTL,
          note: '≈ûekersiz l√ºtfen'
        }
      ],
      totalTL: products[0].priceTL * 2,
      paymentMethod: 'credit_card',
      status: 'completed',
      pointsEarned: Math.floor(products[0].priceTL * 2 * 0.1)
    });
    console.log('üõí Sample orders created');

    // Create Sample Logs
    const now = new Date();
    const sampleLogs = [];
    
    for (let i = 0; i < 50; i++) {
      const daysAgo = Math.floor(Math.random() * 60);
      const logDate = new Date(now);
      logDate.setDate(logDate.getDate() - daysAgo);
      logDate.setHours(Math.floor(Math.random() * 24));
      logDate.setMinutes(Math.floor(Math.random() * 60));
      
      const levels = ['info', 'warning', 'error', 'success'];
      const categories = ['auth', 'business', 'collection', 'shipment', 'order', 'system', 'api'];
      const level = levels[Math.floor(Math.random() * levels.length)];
      const category = categories[Math.floor(Math.random() * categories.length)];
      
      const messages = {
        auth: ['Kullanƒ±cƒ± giri≈ü yaptƒ±', 'Ba≈üarƒ±sƒ±z giri≈ü denemesi', 'Token yenilendi', 'Kullanƒ±cƒ± √ßƒ±kƒ±≈ü yaptƒ±'],
        business: ['Yeni i≈ületme olu≈üturuldu', 'ƒ∞≈ületme bilgileri g√ºncellendi', 'ƒ∞≈ületme durumu deƒüi≈ütirildi', 'ƒ∞≈ületme silindi'],
        collection: ['Yeni koleksiyon olu≈üturuldu', 'Koleksiyon g√ºncellendi', 'Koleksiyon silindi', 'Koleksiyona √ºr√ºn eklendi'],
        shipment: ['Yeni sevkiyat olu≈üturuldu', 'Sevkiyat durumu g√ºncellendi', 'Sevkiyat teslim edildi', 'Sevkiyat iptal edildi'],
        order: ['Yeni sipari≈ü alƒ±ndƒ±', 'Sipari≈ü tamamlandƒ±', 'Sipari≈ü iptal edildi', '√ñdeme ba≈üarƒ±lƒ±'],
        system: ['Sistem ba≈ülatƒ±ldƒ±', 'Veritabanƒ± baƒülantƒ±sƒ± kuruldu', 'Otomatik yedekleme tamamlandƒ±', 'Sistem g√ºncellemesi yapƒ±ldƒ±'],
        api: ['API isteƒüi ba≈üarƒ±lƒ±', 'Rate limit a≈üƒ±ldƒ±', 'API hatasƒ± olu≈ütu', 'Yeni API endpoint eklendi']
      };
      
      const categoryMessages = messages[category];
      const message = categoryMessages[Math.floor(Math.random() * categoryMessages.length)];
      
      sampleLogs.push({
        level,
        message,
        category,
        businessId: Math.random() > 0.5 ? business1._id : null,
        userId: Math.random() > 0.5 ? user1._id : null,
        ipAddress: `192.168.1.${Math.floor(Math.random() * 255)}`,
        userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)',
        createdAt: logDate,
        updatedAt: logDate
      });
    }
    
    await Log.insertMany(sampleLogs);
    console.log('üìã Sample logs created');

    // Create User Collections (tracking)
    await UserCollection.create([
      {
        userId: user1._id,
        collectionId: collection1._id,
        currentCount: 2, // Kullanƒ±cƒ± 2 √ºr√ºn toplamƒ±≈ü
        targetCount: 4,  // Seramik koleksiyonunda 4 √ºr√ºn var
        isCompleted: false
      },
      {
        userId: user1._id,
        collectionId: collection2._id,
        currentCount: 4, // T√ºm √ºr√ºnleri toplamƒ±≈ü
        targetCount: 4,  // Ah≈üap koleksiyonunda 4 √ºr√ºn var
        isCompleted: true,
        completedAt: new Date()
      },
      {
        userId: user1._id,
        collectionId: collection3._id,
        currentCount: 1, // Sadece 1 √ºr√ºn toplamƒ±≈ü
        targetCount: 4,  // Cam koleksiyonunda 4 √ºr√ºn var
        isCompleted: false
      }
    ]);
    console.log('üìö User collections created');

    console.log('\n‚úÖ Database seeded successfully!');
    console.log('\nüìù Login credentials:');
    console.log('Admin: admin@system.com / admin123');
    console.log('Business: info@kahvedukkani.com / business123');
    console.log('\nüìä Statistics:');
    console.log(`- ${tlProducts.length} TL Products (6 categories)`);
    console.log('- 12 Point Products (3 collections)');
    console.log('- 2 Businesses');
    console.log('- 2 Users');
    console.log('- 3 User Collections');
    console.log('\n‚ö†Ô∏è  Note: OAuth users (Google/Apple) need to authenticate through their providers');

    process.exit(0);
  } catch (error) {
    console.error('‚ùå Seed error:', error);
    process.exit(1);
  }
};

seedDatabase();
